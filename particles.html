<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive 3D Particle System - IKB</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            overflow: hidden;
        }

        #canvas-container {
            width: 100vw;
            height: 100vh;
        }

        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 100;
            max-width: 300px;
        }

        .controls h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .control-group select,
        .control-group input[type="range"] {
            width: 100%;
            padding: 8px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-family: inherit;
        }

        .control-group input[type="range"] {
            padding: 0;
            height: 30px;
        }

        .value-display {
            text-align: right;
            color: #667eea;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .color-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .color-btn {
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
            color: white;
        }

        .color-btn:hover {
            transform: scale(1.05);
        }

        .back-btn {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            margin-top: 15px;
            text-align: center;
            transition: opacity 0.3s;
        }

        .back-btn:hover {
            opacity: 0.9;
        }

        .instructions {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            max-width: 250px;
        }

        .instructions h3 {
            color: #667eea;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .instructions p {
            color: #666;
            font-size: 0.85rem;
            line-height: 1.5;
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .controls {
                left: 10px;
                right: 10px;
                max-width: none;
            }

            .instructions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>

    <div class="controls">
        <h2>üé® Particle Controls</h2>
        
        <div class="control-group">
            <label>Shape Template</label>
            <select id="templateSelect">
                <option value="0">Sphere</option>
                <option value="1">Heart ‚ù§Ô∏è</option>
                <option value="2">Saturn ü™ê</option>
                <option value="3">Spiral üåÄ</option>
                <option value="4">Cube üì¶</option>
                <option value="5">Flower üå∏</option>
            </select>
        </div>

        <div class="control-group">
            <label>Expansion</label>
            <input type="range" id="expansionSlider" min="0" max="100" value="50">
            <div class="value-display"><span id="expansionValue">50</span>%</div>
        </div>

        <div class="control-group">
            <label>Rotation Speed</label>
            <input type="range" id="rotationSlider" min="0" max="100" value="30">
            <div class="value-display"><span id="rotationValue">30</span>%</div>
        </div>

        <div class="control-group">
            <label>Color Theme</label>
            <div class="color-buttons">
                <button class="color-btn" style="background: linear-gradient(135deg, #667eea, #764ba2)" onclick="setColor(0)">Blue</button>
                <button class="color-btn" style="background: linear-gradient(135deg, #f093fb, #f5576c)" onclick="setColor(1)">Pink</button>
                <button class="color-btn" style="background: linear-gradient(135deg, #4facfe, #00f2fe)" onclick="setColor(2)">Cyan</button>
                <button class="color-btn" style="background: linear-gradient(135deg, #43e97b, #38f9d7)" onclick="setColor(3)">Green</button>
                <button class="color-btn" style="background: linear-gradient(135deg, #fa709a, #fee140)" onclick="setColor(4)">Sunset</button>
                <button class="color-btn" style="background: linear-gradient(135deg, #30cfd0, #330867)" onclick="setColor(5)">Ocean</button>
            </div>
        </div>

        <a href="projects.html" class="back-btn">‚Üê Back to Projects</a>
    </div>

    <div class="instructions">
        <h3>üñ±Ô∏è Mouse Controls</h3>
        <p>‚Ä¢ <strong>Move mouse</strong> to attract particles</p>
        <p>‚Ä¢ <strong>Click & drag</strong> to rotate view</p>
        <p>‚Ä¢ <strong>Scroll</strong> to zoom in/out</p>
        <p>‚Ä¢ Change shapes and colors using the left panel</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script id="vertex-shader" type="x-shader/x-vertex">
        uniform float u_time;
        uniform float u_templateID;
        uniform float u_gestureIntensity;
        uniform vec3 u_mousePos;
        uniform float u_rotationSpeed;

        attribute float a_particleIndex;

        const float PARTICLE_COUNT = 5000.0;

        vec3 heartTemplate(float t) {
            float x = 16.0 * sin(t) * sin(t) * sin(t);
            float y = 13.0 * cos(t) - 5.0 * cos(2.0 * t) - 2.0 * cos(3.0 * t) - cos(4.0 * t);
            float z = sin(t * 5.0) * 2.0;
            return vec3(x * 0.08, y * 0.08 - 1.0, z * 0.08);
        }

        vec3 saturnTemplate(float t, float index) {
            float angle = index * 0.01 + u_time * u_rotationSpeed * 0.2;
            float radius = 3.0 + sin(t * 20.0) * 0.3;
            float x = radius * cos(angle);
            float y = radius * sin(angle);
            float z = sin(index * 0.05) * cos(u_time * 0.3 + index * 0.01) * 0.8;
            return vec3(x, z, y);
        }

        vec3 spiralTemplate(float t, float index) {
            float angle = t * 20.0 + u_time * u_rotationSpeed * 0.3;
            float radius = t * 5.0;
            float x = radius * cos(angle);
            float y = t * 10.0 - 5.0;
            float z = radius * sin(angle);
            return vec3(x, y, z);
        }

        vec3 cubeTemplate(float t, float index) {
            float face = floor(index / (PARTICLE_COUNT / 6.0));
            float localT = fract(index / (PARTICLE_COUNT / 6.0)) * 6.0;
            float u = fract(localT);
            float v = fract(localT * 1.618);
            float size = 3.0;
            
            vec3 pos;
            if (face < 1.0) pos = vec3(u * size - size/2.0, size/2.0, v * size - size/2.0);
            else if (face < 2.0) pos = vec3(u * size - size/2.0, -size/2.0, v * size - size/2.0);
            else if (face < 3.0) pos = vec3(size/2.0, u * size - size/2.0, v * size - size/2.0);
            else if (face < 4.0) pos = vec3(-size/2.0, u * size - size/2.0, v * size - size/2.0);
            else if (face < 5.0) pos = vec3(u * size - size/2.0, v * size - size/2.0, size/2.0);
            else pos = vec3(u * size - size/2.0, v * size - size/2.0, -size/2.0);
            
            float rotY = u_time * u_rotationSpeed * 0.5;
            float cosY = cos(rotY);
            float sinY = sin(rotY);
            pos = vec3(pos.x * cosY - pos.z * sinY, pos.y, pos.x * sinY + pos.z * cosY);
            
            return pos;
        }

        vec3 flowerTemplate(float t, float index) {
            float angle = t * 6.28 + u_time * u_rotationSpeed * 0.2;
            float petals = 8.0;
            float petalAngle = mod(angle * petals, 6.28);
            float radius = 2.0 + sin(petalAngle) * 1.5;
            radius *= (0.5 + t * 0.5);
            
            float x = radius * cos(angle);
            float y = sin(t * 10.0) * 0.5;
            float z = radius * sin(angle);
            return vec3(x, y, z);
        }

        void main() {
            float t = a_particleIndex / PARTICLE_COUNT;
            vec3 finalPos = position;

            if (u_templateID < 0.5) {
                finalPos = position * (1.0 + u_gestureIntensity * 2.0);
            } else if (u_templateID < 1.5) {
                finalPos = heartTemplate(t * 6.28 + u_time * u_rotationSpeed * 0.1);
            } else if (u_templateID < 2.5) {
                finalPos = saturnTemplate(t, a_particleIndex);
            } else if (u_templateID < 3.5) {
                finalPos = spiralTemplate(t, a_particleIndex);
            } else if (u_templateID < 4.5) {
                finalPos = cubeTemplate(t, a_particleIndex);
            } else {
                finalPos = flowerTemplate(t, a_particleIndex);
            }

            finalPos *= (0.5 + u_gestureIntensity * 1.5);

            float dist = distance(finalPos, u_mousePos);
            if (dist < 5.0) {
                vec3 attraction = normalize(u_mousePos - finalPos) * (5.0 - dist) * 0.3;
                finalPos += attraction;
            }

            vec4 mvPosition = modelViewMatrix * vec4(finalPos, 1.0);
            gl_PointSize = (300.0 / -mvPosition.z) * (0.5 + u_gestureIntensity * 0.5);
            gl_Position = projectionMatrix * mvPosition;
        }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
        uniform float u_colorSwitch;
        uniform vec3 u_colorA;
        uniform vec3 u_colorB;

        void main() {
            vec2 coord = gl_PointCoord - vec2(0.5);
            float r = length(coord);
            
            if (r > 0.5) discard;
            
            float alpha = 1.0 - smoothstep(0.0, 0.5, r);
            alpha = pow(alpha, 2.0);

            vec3 finalColor = mix(u_colorA, u_colorB, u_colorSwitch);
            
            finalColor += vec3(1.0) * (1.0 - r * 2.0) * 0.3;

            gl_FragColor = vec4(finalColor, alpha);
        }
    </script>

    <script>
        const PARTICLE_COUNT = 5000;
        let scene, camera, renderer, particles;
        let mouseX = 0, mouseY = 0;
        let targetRotationX = 0, targetRotationY = 0;
        let isMouseDown = false;

        const colorThemes = [
            { a: [0.4, 0.47, 0.92], b: [0.46, 0.29, 0.64] },
            { a: [0.94, 0.58, 0.98], b: [0.96, 0.34, 0.42] },
            { a: [0.31, 0.67, 0.99], b: [0.0, 0.95, 0.99] },
            { a: [0.26, 0.91, 0.48], b: [0.22, 0.98, 0.84] },
            { a: [0.98, 0.44, 0.60], b: [0.99, 0.88, 0.25] },
            { a: [0.19, 0.81, 0.82], b: [0.20, 0.03, 0.40] }
        ];

        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 10;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000, 1);
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            const geometry = new THREE.BufferGeometry();
            const positions = [];
            const particleIndices = [];

            for (let i = 0; i < PARTICLE_COUNT; i++) {
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos(2 * Math.random() - 1);
                const r = 3;
                
                positions.push(
                    r * Math.sin(phi) * Math.cos(theta),
                    r * Math.sin(phi) * Math.sin(theta),
                    r * Math.cos(phi)
                );
                particleIndices.push(i);
            }

            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('a_particleIndex', new THREE.Float32BufferAttribute(particleIndices, 1));

            const uniforms = {
                u_time: { value: 0 },
                u_templateID: { value: 0 },
                u_mousePos: { value: new THREE.Vector3(0, 0, 0) },
                u_gestureIntensity: { value: 0.5 },
                u_colorSwitch: { value: 0.0 },
                u_colorA: { value: new THREE.Vector3(...colorThemes[0].a) },
                u_colorB: { value: new THREE.Vector3(...colorThemes[0].b) },
                u_rotationSpeed: { value: 0.3 }
            };

            const material = new THREE.ShaderMaterial({
                uniforms: uniforms,
                vertexShader: document.getElementById('vertex-shader').textContent,
                fragmentShader: document.getElementById('fragment-shader').textContent,
                transparent: true,
                blending: THREE.AdditiveBlending,
                depthTest: false
            });

            particles = new THREE.Points(geometry, material);
            scene.add(particles);

            document.getElementById('templateSelect').addEventListener('change', (e) => {
                particles.material.uniforms.u_templateID.value = parseFloat(e.target.value);
            });

            document.getElementById('expansionSlider').addEventListener('input', (e) => {
                const value = e.target.value;
                document.getElementById('expansionValue').textContent = value;
                particles.material.uniforms.u_gestureIntensity.value = value / 100;
            });

            document.getElementById('rotationSlider').addEventListener('input', (e) => {
                const value = e.target.value;
                document.getElementById('rotationValue').textContent = value;
                particles.material.uniforms.u_rotationSpeed.value = value / 100;
            });

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mousedown', () => isMouseDown = true);
            document.addEventListener('mouseup', () => isMouseDown = false);
            window.addEventListener('resize', onWindowResize);
        }

        function setColor(index) {
            particles.material.uniforms.u_colorA.value.set(...colorThemes[index].a);
            particles.material.uniforms.u_colorB.value.set(...colorThemes[index].b);
        }

        function onMouseMove(event) {
            mouseX = (event.clientX / window.innerWidth) * 2 - 1;
            mouseY = -(event.clientY / window.innerHeight) * 2 + 1;

            const vector = new THREE.Vector3(mouseX, mouseY, 0.5);
            vector.unproject(camera);
            const dir = vector.sub(camera.position).normalize();
            const distance = -camera.position.z / dir.z;
            const pos = camera.position.clone().add(dir.multiplyScalar(distance));
            
            particles.material.uniforms.u_mousePos.value.copy(pos);

            if (isMouseDown) {
                targetRotationY += event.movementX * 0.01;
                targetRotationX += event.movementY * 0.01;
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            particles.material.uniforms.u_time.value += 0.01;
            
            particles.rotation.y += (targetRotationY - particles.rotation.y) * 0.05;
            particles.rotation.x += (targetRotationX - particles.rotation.x) * 0.05;

            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
